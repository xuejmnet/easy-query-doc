import{_ as c}from"./plugin-vue_export-helper-c27b6911.js";import{r as l,o as r,c as u,d as i,w as a,e as o,b as s,a as n}from"./app-80271ac9.js";const k={},d=o('<p><code>easy-query</code>提供了高效,高性能的分片机制,完美的屏蔽分片带来的业务复杂度,不同于<code>sharding-jdbc</code>的sql的<code>antlr</code>解析采用自带的表达式解析性能高效,并且不同于<code>ShardingSphere-Proxy</code>的代理模式,导致未分片的对象也需要走代理,并且需要多次jdbc,<code>easy-query</code>采用客户端分片保证分片下的高性能查询结果返回,并且原生orm框架自带无需使用额外组件,更少的依赖来保证程序的健壮与可控</p><h2 id="创建数据库" tabindex="-1"><a class="header-anchor" href="#创建数据库" aria-hidden="true">#</a> 创建数据库</h2><p>我们以订单表为例来实现订单的简单取模分库,将订单表按5取模进行分库分为ds0,ds1,ds2,ds3,ds4一共5个数据源</p>',3),m=n("div",{class:"language-sql line-numbers-mode","data-ext":"sql"},[n("pre",{class:"language-sql"},[n("code",null,[s(`
`),n("span",{class:"token keyword"},"CREATE"),s(),n("span",{class:"token keyword"},"DATABASE"),s(),n("span",{class:"token keyword"},"IF"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token keyword"},"EXISTS"),s(" easy_sample "),n("span",{class:"token keyword"},"CHARACTER"),s(),n("span",{class:"token keyword"},"SET"),s(),n("span",{class:"token string"},"'utf8mb4'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"USE"),s(" easy_sample"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"create"),s(),n("span",{class:"token keyword"},"table"),s(` ds_order
`),n("span",{class:"token punctuation"},"("),s(`
    id `),n("span",{class:"token keyword"},"varchar"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"32"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'主键ID'"),n("span",{class:"token keyword"},"primary"),s(),n("span",{class:"token keyword"},"key"),n("span",{class:"token punctuation"},","),s(`
    uid `),n("span",{class:"token keyword"},"varchar"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"50"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'用户id'"),n("span",{class:"token punctuation"},","),s(`
    order_no `),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单号'"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token keyword"},"status"),s(),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单状态'"),n("span",{class:"token punctuation"},","),s(`
    create_time `),n("span",{class:"token keyword"},"datetime"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'创建时间'"),s(`
`),n("span",{class:"token punctuation"},")"),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单表'"),n("span",{class:"token punctuation"},";"),s(`


`),n("span",{class:"token keyword"},"CREATE"),s(),n("span",{class:"token keyword"},"DATABASE"),s(),n("span",{class:"token keyword"},"IF"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token keyword"},"EXISTS"),s(" easy_sample1 "),n("span",{class:"token keyword"},"CHARACTER"),s(),n("span",{class:"token keyword"},"SET"),s(),n("span",{class:"token string"},"'utf8mb4'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"USE"),s(" easy_sample1"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"create"),s(),n("span",{class:"token keyword"},"table"),s(` ds_order
`),n("span",{class:"token punctuation"},"("),s(`
    id `),n("span",{class:"token keyword"},"varchar"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"32"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'主键ID'"),n("span",{class:"token keyword"},"primary"),s(),n("span",{class:"token keyword"},"key"),n("span",{class:"token punctuation"},","),s(`
    uid `),n("span",{class:"token keyword"},"varchar"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"50"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'用户id'"),n("span",{class:"token punctuation"},","),s(`
    order_no `),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单号'"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token keyword"},"status"),s(),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单状态'"),n("span",{class:"token punctuation"},","),s(`
    create_time `),n("span",{class:"token keyword"},"datetime"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'创建时间'"),s(`
`),n("span",{class:"token punctuation"},")"),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单表'"),n("span",{class:"token punctuation"},";"),s(`


`),n("span",{class:"token keyword"},"CREATE"),s(),n("span",{class:"token keyword"},"DATABASE"),s(),n("span",{class:"token keyword"},"IF"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token keyword"},"EXISTS"),s(" easy_sample2 "),n("span",{class:"token keyword"},"CHARACTER"),s(),n("span",{class:"token keyword"},"SET"),s(),n("span",{class:"token string"},"'utf8mb4'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"USE"),s(" easy_sample2"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"create"),s(),n("span",{class:"token keyword"},"table"),s(` ds_order
`),n("span",{class:"token punctuation"},"("),s(`
    id `),n("span",{class:"token keyword"},"varchar"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"32"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'主键ID'"),n("span",{class:"token keyword"},"primary"),s(),n("span",{class:"token keyword"},"key"),n("span",{class:"token punctuation"},","),s(`
    uid `),n("span",{class:"token keyword"},"varchar"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"50"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'用户id'"),n("span",{class:"token punctuation"},","),s(`
    order_no `),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单号'"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token keyword"},"status"),s(),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单状态'"),n("span",{class:"token punctuation"},","),s(`
    create_time `),n("span",{class:"token keyword"},"datetime"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'创建时间'"),s(`
`),n("span",{class:"token punctuation"},")"),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单表'"),n("span",{class:"token punctuation"},";"),s(`


`),n("span",{class:"token keyword"},"CREATE"),s(),n("span",{class:"token keyword"},"DATABASE"),s(),n("span",{class:"token keyword"},"IF"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token keyword"},"EXISTS"),s(" easy_sample3 "),n("span",{class:"token keyword"},"CHARACTER"),s(),n("span",{class:"token keyword"},"SET"),s(),n("span",{class:"token string"},"'utf8mb4'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"USE"),s(" easy_sample3"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"create"),s(),n("span",{class:"token keyword"},"table"),s(` ds_order
`),n("span",{class:"token punctuation"},"("),s(`
    id `),n("span",{class:"token keyword"},"varchar"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"32"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'主键ID'"),n("span",{class:"token keyword"},"primary"),s(),n("span",{class:"token keyword"},"key"),n("span",{class:"token punctuation"},","),s(`
    uid `),n("span",{class:"token keyword"},"varchar"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"50"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'用户id'"),n("span",{class:"token punctuation"},","),s(`
    order_no `),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单号'"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token keyword"},"status"),s(),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单状态'"),n("span",{class:"token punctuation"},","),s(`
    create_time `),n("span",{class:"token keyword"},"datetime"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'创建时间'"),s(`
`),n("span",{class:"token punctuation"},")"),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单表'"),n("span",{class:"token punctuation"},";"),s(`


`),n("span",{class:"token keyword"},"CREATE"),s(),n("span",{class:"token keyword"},"DATABASE"),s(),n("span",{class:"token keyword"},"IF"),s(),n("span",{class:"token operator"},"NOT"),s(),n("span",{class:"token keyword"},"EXISTS"),s(" easy_sample4 "),n("span",{class:"token keyword"},"CHARACTER"),s(),n("span",{class:"token keyword"},"SET"),s(),n("span",{class:"token string"},"'utf8mb4'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"USE"),s(" easy_sample4"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"create"),s(),n("span",{class:"token keyword"},"table"),s(` ds_order
`),n("span",{class:"token punctuation"},"("),s(`
    id `),n("span",{class:"token keyword"},"varchar"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"32"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'主键ID'"),n("span",{class:"token keyword"},"primary"),s(),n("span",{class:"token keyword"},"key"),n("span",{class:"token punctuation"},","),s(`
    uid `),n("span",{class:"token keyword"},"varchar"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"50"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'用户id'"),n("span",{class:"token punctuation"},","),s(`
    order_no `),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单号'"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token keyword"},"status"),s(),n("span",{class:"token keyword"},"int"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单状态'"),n("span",{class:"token punctuation"},","),s(`
    create_time `),n("span",{class:"token keyword"},"datetime"),s(),n("span",{class:"token operator"},"not"),s(),n("span",{class:"token boolean"},"null"),s(),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'创建时间'"),s(`
`),n("span",{class:"token punctuation"},")"),n("span",{class:"token keyword"},"comment"),s(),n("span",{class:"token string"},"'订单表'"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),v=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{class:"language-java"},[n("code",null,[n("span",{class:"token comment"},"//数据库对象"),s(`

`),n("span",{class:"token annotation punctuation"},"@Data"),s(`
`),n("span",{class:"token annotation punctuation"},"@Table"),n("span",{class:"token punctuation"},"("),s("value "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"ds_order"'),n("span",{class:"token punctuation"},","),s("shardingInitializer "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"DsOrderShardingInitializer"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"class"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"DsOrderEntity"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token annotation punctuation"},"@Column"),n("span",{class:"token punctuation"},"("),s("primaryKey "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token annotation punctuation"},"@ShardingDataSourceKey"),s(`
    `),n("span",{class:"token annotation punctuation"},"@UpdateIgnore"),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token class-name"},"String"),s(" id"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token class-name"},"String"),s(" uid"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token class-name"},"Integer"),s(" orderNo"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token class-name"},"Integer"),s(" status"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token class-name"},"LocalDateTime"),s(" createTime"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"//分片初始化器,和5进行取模,获取ds0-ds4一共5个数据源每个数据源都只有一张表"),s(`
`),n("span",{class:"token annotation punctuation"},"@Component"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"DsOrderShardingInitializer"),s(),n("span",{class:"token keyword"},"implements"),s(),n("span",{class:"token class-name"},"EntityShardingInitializer"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"DsOrderEntity"),n("span",{class:"token punctuation"},">")]),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token annotation punctuation"},"@Override"),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"configure"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ShardingEntityBuilder"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"DsOrderEntity"),n("span",{class:"token punctuation"},">")]),s(" builder"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"EntityMetadata"),s(" entityMetadata "),n("span",{class:"token operator"},"="),s(" builder"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getEntityMetadata"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"String"),s(" tableName "),n("span",{class:"token operator"},"="),s(" entityMetadata"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getTableName"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"List"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},">")]),s(" tables "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"Collections"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"singletonList"),n("span",{class:"token punctuation"},"("),s("tableName"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"LinkedHashMap"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Collection"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},">"),n("span",{class:"token punctuation"},">")]),s(" initTables "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"LinkedHashMap"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Collection"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},">"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token function"},"put"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ds0"'),n("span",{class:"token punctuation"},","),s(" tables"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token function"},"put"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ds1"'),n("span",{class:"token punctuation"},","),s(" tables"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token function"},"put"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ds2"'),n("span",{class:"token punctuation"},","),s(" tables"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token function"},"put"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ds3"'),n("span",{class:"token punctuation"},","),s(" tables"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token function"},"put"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ds4"'),n("span",{class:"token punctuation"},","),s(" tables"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
        builder`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"actualTableNameInit"),n("span",{class:"token punctuation"},"("),s("initTables"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token comment"},"//分片的路由,路由使用默认抽象的分库路由AbstractDataSourceRoute,编写RouteFunction"),s(`
`),n("span",{class:"token annotation punctuation"},"@Component"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"DsOrderDataSourceRoute"),s(),n("span",{class:"token keyword"},"extends"),s(),n("span",{class:"token class-name"},"AbstractDataSourceRoute"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"DsOrderEntity"),n("span",{class:"token punctuation"},">")]),s(),n("span",{class:"token punctuation"},"{"),s(`

    `),n("span",{class:"token annotation punctuation"},"@Override"),s(`
    `),n("span",{class:"token keyword"},"protected"),s(),n("span",{class:"token class-name"},"RouteFunction"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},">")]),s(),n("span",{class:"token function"},"getRouteFilter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"TableAvailable"),s(" table"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Object"),s(" shardingValue"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ShardingOperatorEnum"),s(" shardingOperator"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"boolean"),s(" withEntity"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"int"),s(" i "),n("span",{class:"token operator"},"="),s(" shardingValue"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toString"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"hashCode"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"int"),s(" dsNumber "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"Math"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"abs"),n("span",{class:"token punctuation"},"("),s("i "),n("span",{class:"token operator"},"%"),s(),n("span",{class:"token number"},"5"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"//0-5"),s(`
        `),n("span",{class:"token class-name"},"String"),s(" dataSource "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"ds"'),s(),n("span",{class:"token operator"},"+"),s(" dsNumber"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"switch"),s(),n("span",{class:"token punctuation"},"("),s("shardingOperator"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"case"),s(),n("span",{class:"token constant"},"EQUAL"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token comment"},"//仅支持==操作"),s(`
                `),n("span",{class:"token keyword"},"return"),s(" ds "),n("span",{class:"token operator"},"->"),s(" dataSource"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"compareToIgnoreCase"),n("span",{class:"token punctuation"},"("),s("ds"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token keyword"},"default"),n("span",{class:"token operator"},":"),s(`
                `),n("span",{class:"token keyword"},"return"),s(" t "),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),b=o(`<h2 id="配置文件" tabindex="-1"><a class="header-anchor" href="#配置文件" aria-hidden="true">#</a> 配置文件</h2><p>因为分片涉及到跨表聚合所以需要设置默认数据源的连接池大小，并且设置分片可用数据源大小</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>

  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/easy_sample<span class="token punctuation">?</span>serverTimezone=GMT%2B8<span class="token important">&amp;characterEncoding=utf-8&amp;useSSL=false&amp;allowMultiQueries=true&amp;rewriteBatchedStatements=true</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
    <span class="token key atrule">druid</span><span class="token punctuation">:</span>
      <span class="token key atrule">initial-size</span><span class="token punctuation">:</span> <span class="token number">10</span>
      <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">100</span>

<span class="token key atrule">easy-query</span><span class="token punctuation">:</span>
  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">name-conversion</span><span class="token punctuation">:</span> underlined
  <span class="token key atrule">database</span><span class="token punctuation">:</span> mysql
  <span class="token key atrule">defaultDataSourceMergePoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们设置了最大连接数100,分片可用连接池数50保证至少有50个连接可以给非分片用,当然另外50个非分片会和分片进行竞争</p><h2 id="添加额外数据源" tabindex="-1"><a class="header-anchor" href="#添加额外数据源" aria-hidden="true">#</a> 添加额外数据源</h2><p>默认springboot下的数据源name为ds0所以我们还需要额外添加4个数据源</p><p>springboot启动后我们可以通过数据库或者其他方式来获取链接字符串来手动构建datasource,启动后会创建ds1-ds4一共4个数据源额外加一个默认数据源一共5个</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShardingInitRunner</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationRunner</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">EasyQuery</span> easyQuery<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ApplicationArguments</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DataSource</span><span class="token punctuation">&gt;</span></span> dataSources <span class="token operator">=</span> <span class="token function">createDataSources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataSourceManager</span> dataSourceManager <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">getRuntimeContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDataSourceManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DataSource</span><span class="token punctuation">&gt;</span></span> stringDataSourceEntry <span class="token operator">:</span> dataSources<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            dataSourceManager<span class="token punctuation">.</span><span class="token function">addDataSource</span><span class="token punctuation">(</span>stringDataSourceEntry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stringDataSourceEntry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;初始化完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DataSource</span><span class="token punctuation">&gt;</span></span> <span class="token function">createDataSources</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DataSource</span><span class="token punctuation">&gt;</span></span> stringDataSourceHashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//可以通过数据库查询或者其他方式来存储额外数据源</span>
            <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token function">createDataSource</span><span class="token punctuation">(</span><span class="token string">&quot;ds&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token string">&quot;jdbc:mysql://127.0.0.1:3306/easy_sample&quot;</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">&quot;?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false&amp;allowMultiQueries=true&amp;rewriteBatchedStatements=true&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stringDataSourceHashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ds&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> stringDataSourceHashMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> <span class="token function">createDataSource</span><span class="token punctuation">(</span><span class="token class-name">String</span> dsName<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 设置properties</span>
        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> dsName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;driverClassName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;initialSize&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;maxActive&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">EasyQueryException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="新增" tabindex="-1"><a class="header-anchor" href="#新增" aria-hidden="true">#</a> 新增</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/orderShardingDataSource&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span><span class="token punctuation">(</span>onConstructor_ <span class="token operator">=</span> <span class="token annotation punctuation">@Autowired</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderShardingDataSourceController</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EasyQuery</span> easyQuery<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/add&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DsOrderEntity</span><span class="token punctuation">&gt;</span></span> orderEntities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;xiaoming&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xiaohong&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xiaolan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">DsOrderEntity</span> orderEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DsOrderEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> i1 <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> uid <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderEntity<span class="token punctuation">.</span><span class="token function">setUid</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderEntity<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderEntity<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderEntities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>orderEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> l <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">insertable</span><span class="token punctuation">(</span>orderEntities<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;成功插入:&quot;</span><span class="token operator">+</span>l<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_1<span class="token punctuation">,</span> name<span class="token operator">:</span>ds0<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> INSERT INTO \`ds_order\` <span class="token operator">(</span>\`id\`<span class="token punctuation">,</span>\`uid\`<span class="token punctuation">,</span>\`order_no\`<span class="token punctuation">,</span>\`status\`<span class="token punctuation">,</span>\`create_time\`<span class="token operator">)</span> VALUES <span class="token operator">(</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_1<span class="token punctuation">,</span> name<span class="token operator">:</span>ds0<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">2</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span>xiaolan<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-09-04T</span><span class="token time number">22:02:31.509635</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_5<span class="token punctuation">,</span> name<span class="token operator">:</span>ds3<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> INSERT INTO \`ds_order\` <span class="token operator">(</span>\`id\`<span class="token punctuation">,</span>\`uid\`<span class="token punctuation">,</span>\`order_no\`<span class="token punctuation">,</span>\`status\`<span class="token punctuation">,</span>\`create_time\`<span class="token operator">)</span> VALUES <span class="token operator">(</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_5<span class="token punctuation">,</span> name<span class="token operator">:</span>ds3<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">0</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span>xiaoming<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-09-04T</span><span class="token time number">22:02:31.509610</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_4<span class="token punctuation">,</span> name<span class="token operator">:</span>ds4<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> INSERT INTO \`ds_order\` <span class="token operator">(</span>\`id\`<span class="token punctuation">,</span>\`uid\`<span class="token punctuation">,</span>\`order_no\`<span class="token punctuation">,</span>\`status\`<span class="token punctuation">,</span>\`create_time\`<span class="token operator">)</span> VALUES <span class="token operator">(</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_4<span class="token punctuation">,</span> name<span class="token operator">:</span>ds4<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">1</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span>xiaohong<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-09-04T</span><span class="token time number">22:02:31.509631</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_2<span class="token punctuation">,</span> name<span class="token operator">:</span>ds2<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> INSERT INTO \`ds_order\` <span class="token operator">(</span>\`id\`<span class="token punctuation">,</span>\`uid\`<span class="token punctuation">,</span>\`order_no\`<span class="token punctuation">,</span>\`status\`<span class="token punctuation">,</span>\`create_time\`<span class="token operator">)</span> VALUES <span class="token operator">(</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_2<span class="token punctuation">,</span> name<span class="token operator">:</span>ds2<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">4</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span>xiaohong<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-09-04T</span><span class="token time number">22:02:31.509640</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_3<span class="token punctuation">,</span> name<span class="token operator">:</span>ds1<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> INSERT INTO \`ds_order\` <span class="token operator">(</span>\`id\`<span class="token punctuation">,</span>\`uid\`<span class="token punctuation">,</span>\`order_no\`<span class="token punctuation">,</span>\`status\`<span class="token punctuation">,</span>\`create_time\`<span class="token operator">)</span> VALUES <span class="token operator">(</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_3<span class="token punctuation">,</span> name<span class="token operator">:</span>ds1<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">3</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span>xiaoming<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-09-04T</span><span class="token time number">22:02:31.509637</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> SHARDING_EXECUTOR_1<span class="token punctuation">,</span> name<span class="token operator">:</span>ds0<span class="token punctuation">,</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_1<span class="token punctuation">,</span> name<span class="token operator">:</span>ds0<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> INSERT INTO \`ds_order\` <span class="token operator">(</span>\`id\`<span class="token punctuation">,</span>\`uid\`<span class="token punctuation">,</span>\`order_no\`<span class="token punctuation">,</span>\`status\`<span class="token punctuation">,</span>\`create_time\`<span class="token operator">)</span> VALUES <span class="token operator">(</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_1<span class="token punctuation">,</span> name<span class="token operator">:</span>ds0<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">7</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span>xiaohong<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-09-04T</span><span class="token time number">22:02:31.509647</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> SHARDING_EXECUTOR_4<span class="token punctuation">,</span> name<span class="token operator">:</span>ds4<span class="token punctuation">,</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_4<span class="token punctuation">,</span> name<span class="token operator">:</span>ds4<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> INSERT INTO \`ds_order\` <span class="token operator">(</span>\`id\`<span class="token punctuation">,</span>\`uid\`<span class="token punctuation">,</span>\`order_no\`<span class="token punctuation">,</span>\`status\`<span class="token punctuation">,</span>\`create_time\`<span class="token operator">)</span> VALUES <span class="token operator">(</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_4<span class="token punctuation">,</span> name<span class="token operator">:</span>ds4<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">6</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span>xiaoming<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-09-04T</span><span class="token time number">22:02:31.509645</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> SHARDING_EXECUTOR_5<span class="token punctuation">,</span> name<span class="token operator">:</span>ds3<span class="token punctuation">,</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_5<span class="token punctuation">,</span> name<span class="token operator">:</span>ds3<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> INSERT INTO \`ds_order\` <span class="token operator">(</span>\`id\`<span class="token punctuation">,</span>\`uid\`<span class="token punctuation">,</span>\`order_no\`<span class="token punctuation">,</span>\`status\`<span class="token punctuation">,</span>\`create_time\`<span class="token operator">)</span> VALUES <span class="token operator">(</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_5<span class="token punctuation">,</span> name<span class="token operator">:</span>ds3<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">5</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span>xiaolan<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-09-04T</span><span class="token time number">22:02:31.509642</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> SHARDING_EXECUTOR_2<span class="token punctuation">,</span> name<span class="token operator">:</span>ds2<span class="token punctuation">,</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_2<span class="token punctuation">,</span> name<span class="token operator">:</span>ds2<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> INSERT INTO \`ds_order\` <span class="token operator">(</span>\`id\`<span class="token punctuation">,</span>\`uid\`<span class="token punctuation">,</span>\`order_no\`<span class="token punctuation">,</span>\`status\`<span class="token punctuation">,</span>\`create_time\`<span class="token operator">)</span> VALUES <span class="token operator">(</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_2<span class="token punctuation">,</span> name<span class="token operator">:</span>ds2<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">9</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span>xiaoming<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-09-04T</span><span class="token time number">22:02:31.509652</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> SHARDING_EXECUTOR_3<span class="token punctuation">,</span> name<span class="token operator">:</span>ds1<span class="token punctuation">,</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> SHARDING_EXECUTOR_4<span class="token punctuation">,</span> name<span class="token operator">:</span>ds4<span class="token punctuation">,</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> SHARDING_EXECUTOR_1<span class="token punctuation">,</span> name<span class="token operator">:</span>ds0<span class="token punctuation">,</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_3<span class="token punctuation">,</span> name<span class="token operator">:</span>ds1<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> INSERT INTO \`ds_order\` <span class="token operator">(</span>\`id\`<span class="token punctuation">,</span>\`uid\`<span class="token punctuation">,</span>\`order_no\`<span class="token punctuation">,</span>\`status\`<span class="token punctuation">,</span>\`create_time\`<span class="token operator">)</span> VALUES <span class="token operator">(</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> SHARDING_EXECUTOR_3<span class="token punctuation">,</span> name<span class="token operator">:</span>ds1<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">8</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span>xiaolan<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-09-04T</span><span class="token time number">22:02:31.509650</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> SHARDING_EXECUTOR_5<span class="token punctuation">,</span> name<span class="token operator">:</span>ds3<span class="token punctuation">,</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> SHARDING_EXECUTOR_3<span class="token punctuation">,</span> name<span class="token operator">:</span>ds1<span class="token punctuation">,</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> SHARDING_EXECUTOR_2<span class="token punctuation">,</span> name<span class="token operator">:</span>ds2<span class="token punctuation">,</span> Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>name ds0-ds4分别对应分库插入的数据源。</p><h2 id="修改" tabindex="-1"><a class="header-anchor" href="#修改" aria-hidden="true">#</a> 修改</h2><p>进修改时间所以只会变更时间</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/edit&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EasyQueryTrack</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">DsOrderEntity</span> orderEntity <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">queryable</span><span class="token punctuation">(</span><span class="token class-name">DsOrderEntity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">asTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>o<span class="token operator">-&gt;</span>o<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">DsOrderEntity</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">firstNotNull</span><span class="token punctuation">(</span><span class="token string">&quot;未找到对应的订单&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderEntity<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span>orderEntity<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> orderEntity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对象更新可以通过id直接路由到对应的库保证用户无感更新,且数据高性能更新</p><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">:</span>ds4<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> SELECT \`id\`<span class="token punctuation">,</span>\`uid\`<span class="token punctuation">,</span>\`order_no\`<span class="token punctuation">,</span>\`status\`<span class="token punctuation">,</span>\`create_time\` FROM \`ds_order\` WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span> LIMIT <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">:</span>ds4<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">1</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">:</span>ds4<span class="token punctuation">,</span> Time Elapsed<span class="token operator">:</span> <span class="token number">26</span><span class="token operator">(</span>ms<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">:</span>ds4<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> UPDATE \`ds_order\` SET \`create_time\` <span class="token operator">=</span> <span class="token operator">?</span> WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">:</span>ds4<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token date number">2023-09-05T</span><span class="token time number">08:47:48.703659</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">:</span>ds4<span class="token punctuation">,</span> Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>java并发更新</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/concurrentEdit&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EasyQueryTrack</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">concurrentEdit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">DsOrderEntity</span> orderEntity <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">queryable</span><span class="token punctuation">(</span><span class="token class-name">DsOrderEntity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">asTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>o<span class="token operator">-&gt;</span>o<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">DsOrderEntity</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">firstNotNull</span><span class="token punctuation">(</span><span class="token string">&quot;未找到对应的订单&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>orderEntity<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;订单状态不是2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    orderEntity<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderEntity<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span>orderEntity<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">whereColumns</span><span class="token punctuation">(</span>o<span class="token operator">-&gt;</span>o<span class="token punctuation">.</span><span class="token function">columnKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token class-name">DsOrderEntity</span><span class="token operator">::</span><span class="token function">getStatus</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;并发修改失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> orderEntity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>并发更新分库,高性能命中对应的库</p><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span>ds0<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> SELECT \`id\`<span class="token punctuation">,</span>\`uid\`<span class="token punctuation">,</span>\`order_no\`<span class="token punctuation">,</span>\`status\`<span class="token punctuation">,</span>\`create_time\` FROM \`ds_order\` WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span> LIMIT <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span>ds0<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">2</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span>ds0<span class="token punctuation">,</span> Time Elapsed<span class="token operator">:</span> <span class="token number">6</span><span class="token operator">(</span>ms<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span>ds0<span class="token punctuation">,</span> Preparing<span class="token operator">:</span> UPDATE \`ds_order\` SET \`status\` <span class="token operator">=</span> <span class="token operator">?</span><span class="token punctuation">,</span>\`create_time\` <span class="token operator">=</span> <span class="token operator">?</span> WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span> AND \`status\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span>ds0<span class="token punctuation">,</span> Parameters<span class="token operator">:</span> <span class="token number">3</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-09-05T</span><span class="token time number">08:54:19.189373</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">(</span>Integer<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span>ds0<span class="token punctuation">,</span> Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,21);function g(y,w){const e=l("CodeTabs");return r(),u("div",null,[d,i(e,{id:"9",data:[{id:"sql脚本"},{id:"数据库对象"}]},{title0:a(({value:t,isActive:p})=>[s("sql脚本")]),title1:a(({value:t,isActive:p})=>[s("数据库对象")]),tab0:a(({value:t,isActive:p})=>[m]),tab1:a(({value:t,isActive:p})=>[v]),_:1}),b])}const T=c(k,[["render",g],["__file","sharding-datasource.html.vue"]]);export{T as default};
