import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as a,e as p}from"./app-b58f27ee.js";const t={},o=p(`<h1 id="修改" tabindex="-1"><a class="header-anchor" href="#修改" aria-hidden="true">#</a> 修改</h1><p><code>EasyQuery</code>提供了单条修改、批量修改和表达式修改数据的方法,可以返回数据库执行修改后的受影响行数。</p><p>数据库建表脚本</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_topic
<span class="token punctuation">(</span>
    id <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;主键ID&#39;</span><span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    stars <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;点赞数&#39;</span><span class="token punctuation">,</span>
    title <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;标题&#39;</span><span class="token punctuation">,</span>
    create_time <span class="token keyword">datetime</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">&#39;创建时间&#39;</span>
<span class="token punctuation">)</span><span class="token keyword">comment</span> <span class="token string">&#39;主题表&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>java实体对象</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span><span class="token string">&quot;t_topic&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Topic</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>primaryKey <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> stars<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_0-对象主键更新" tabindex="-1"><a class="header-anchor" href="#_0-对象主键更新" aria-hidden="true">#</a> 0.对象主键更新</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Topic</span> topic<span class="token operator">=</span>easyQuery<span class="token punctuation">.</span><span class="token function">queryable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whereById</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">firstOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> rows <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-更新指定列" tabindex="-1"><a class="header-anchor" href="#_1-更新指定列" aria-hidden="true">#</a> 1.更新指定列</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">long</span> rows <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getStars</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//rows为1</span>
easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getStars</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;更新失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//判断受影响行数并且进行报错,如果当前操作不在事务内执行那么会自动开启事务!!!会自动开启事务!!!会自动开启事务!!!来实现并发更新控制,异常为:EasyQueryConcurrentException </span>
<span class="token comment">//抛错后数据将不会被更新</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing<span class="token operator">:</span> UPDATE t_topic SET \`stars\` <span class="token operator">=</span> <span class="token operator">?</span> WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> <span class="token number">12</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>支持多次<code>set</code>,多次set表示<code>set</code>拼接</p><h2 id="_2-表列自更新" tabindex="-1"><a class="header-anchor" href="#_2-表列自更新" aria-hidden="true">#</a> 2.表列自更新</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">long</span> rows <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getTitle</span><span class="token punctuation">,</span> <span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getStars</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//rows为1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing<span class="token operator">:</span> UPDATE t_topic SET \`title\` <span class="token operator">=</span> \`stars\` WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> <span class="token number">2</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-表列原子更新" tabindex="-1"><a class="header-anchor" href="#_3-表列原子更新" aria-hidden="true">#</a> 3.表列原子更新</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">long</span> rows1 <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getStars</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> rows2 <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getStars</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> rows3 <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setDecrement</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getStars</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> rows4 <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setDecrement</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getStars</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing<span class="token operator">:</span> UPDATE t_topic SET \`stars\` <span class="token operator">=</span> \`stars\`<span class="token operator">+</span><span class="token operator">?</span> WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> <span class="token number">1</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing<span class="token operator">:</span> UPDATE t_topic SET \`stars\` <span class="token operator">=</span> \`stars\`<span class="token operator">+</span><span class="token operator">?</span> WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> <span class="token number">2</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing<span class="token operator">:</span> UPDATE t_topic SET \`stars\` <span class="token operator">=</span> \`stars\`<span class="token operator">-</span><span class="token operator">?</span> WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> <span class="token number">1</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing<span class="token operator">:</span> UPDATE t_topic SET \`stars\` <span class="token operator">=</span> \`stars\`<span class="token operator">-</span><span class="token operator">?</span> WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> <span class="token number">2</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-差异更新" tabindex="-1"><a class="header-anchor" href="#_3-差异更新" aria-hidden="true">#</a> 3.差异更新</h2><div class="hint-container tip"><p class="hint-container-title">说明!!!</p><blockquote><p>差异更新可以自动监听被追踪的对象,并且生成差异更新语句,而不是无脑的对对象进行全字段更新,使用时需要开启当前追踪环境并且对查询出来的结果进行追踪后续即可监听到变更列实现差异化update语句</p></blockquote></div><p>正常情况下如果用户想使用差异更新,那么需要对查询采用<code>asTracking</code>来让返回结果被追踪,或者调用<code>easyQuery.addTracking</code>来让需要更新的对象被追踪</p><p>如果希望默认是追踪的可以设置启动配置<code>defaultTrack</code>为true那么只需要开始上下文环境即可</p><div class="hint-container danger"><p class="hint-container-title">错误的用法!!!</p><blockquote><p>开启上下文追踪当时没有讲查询结果对象附加到当前上下文,所以框架无法追踪对象变更无法有效生成差异更新</p></blockquote></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">TrackManager</span> trackManager <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">getRuntimeContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTrackManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span><span class="token punctuation">{</span>

        trackManager<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Topic</span> topic <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">queryable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token string">&quot;7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">firstNotNull</span><span class="token punctuation">(</span><span class="token string">&quot;未找到对应的数据&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> newTitle <span class="token operator">=</span> <span class="token string">&quot;test123&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        topic<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>newTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> rows<span class="token operator">=</span>easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
        trackManager<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing<span class="token operator">:</span> UPDATE t_topic SET \`stars\` <span class="token operator">=</span> <span class="token operator">?</span><span class="token punctuation">,</span>\`title\` <span class="token operator">=</span> <span class="token operator">?</span><span class="token punctuation">,</span>\`create_time\` <span class="token operator">=</span> <span class="token operator">?</span> WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> <span class="token number">107</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span>test12364<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-03-27T</span><span class="token time number">22:05:23</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">正确的用法!!!</p><blockquote><ul><li>要注意是否开启了追踪<code>spring-boot</code>下用<code>@EasyQueryTrack</code>注解即可开启</li><li>是否将当前对象添加到了追踪上下文 查询添加<code>asTracking</code>或者 手动将查询出来的对象进行<code>easyQuery.addTracking(Object entity)</code></li></ul></blockquote></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">TrackManager</span> trackManager <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">getRuntimeContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTrackManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span><span class="token punctuation">{</span>
        trackManager<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Topic</span> topic <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">queryable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token string">&quot;7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">firstNotNull</span><span class="token punctuation">(</span><span class="token string">&quot;未找到对应的数据&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> newTitle <span class="token operator">=</span> <span class="token string">&quot;test123&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        topic<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>newTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> l <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>

        trackManager<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing<span class="token operator">:</span> UPDATE t_topic SET \`title\` <span class="token operator">=</span> <span class="token operator">?</span> WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> test1239<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>清晰的看到差异更新只会更新需要更新的列</p><div class="hint-container warning"><p class="hint-container-title">追踪注意点及说明!!!</p><blockquote><p>原因是正确的写法在开启追踪后查询使用了<code>.asTracking()</code>那么会让所有的结果集全部被追踪(如果查询数据量有几万或者几十万那么性能肯定会有影响)，被追踪的返回结果对象必须要满足是数据库实体才可以，如果附加实体的时候发现当前上下文已经有被追踪的实体，那么直接放弃当前查询出来的结果，直接使用被追踪的数据作为当前对象，如果需要更新的列一个都没有，那么easy-query将不会生成update的sql语句并且返回0行，因为没有数据需要被修改</p></blockquote></div><ul><li>选择性追踪<br> 我们可能会有这样的需求这边需要查询出几百上万条数据，但是追踪更新只会涉及到1-2条，如果整个查询采用<code>.asTracking()</code>那么性能会相对低下，所以提供了额外的追踪方法</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token class-name">TrackManager</span> trackManager <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">getRuntimeContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTrackManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>

            trackManager<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Topic</span> topic <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">queryable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> <span class="token string">&quot;7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">firstNotNull</span><span class="token punctuation">(</span><span class="token string">&quot;未找到对应的数据&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            easyQuery<span class="token punctuation">.</span><span class="token function">addTracking</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> newTitle <span class="token operator">=</span> <span class="token string">&quot;test123&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            topic<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>newTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> l <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>

            trackManager<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing<span class="token operator">:</span> UPDATE t_topic SET \`title\` <span class="token operator">=</span> <span class="token operator">?</span> WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> test12398<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过对查询数据采用非追踪查询后续再修改数据前将其进行添加到追踪里面可以保证更新也是差异更新</p><p>可能会有小伙伴认为这种做法太复杂了有没有建议的方法，这边<code>easy-query</code>已经给大家针对spring-boot的项目进行了aop的封装，<br> 如果是springboot的小伙伴只需要在更新方法外部加上aop注解即可<code>@EasyQueryTrack</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sayHello&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EasyQueryTrack</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">TestUserMysql0</span> testUserMysql <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">queryable</span><span class="token punctuation">(</span><span class="token class-name">TestUserMysql0</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">asTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//如果不添加那么不会追踪数据</span>
        <span class="token punctuation">.</span><span class="token function">firstOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> testUserMysql<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-指定列更新或条件" tabindex="-1"><a class="header-anchor" href="#_4-指定列更新或条件" aria-hidden="true">#</a> 4.指定列更新或条件</h2><p>在对象更新的情况下可以选择对应的列进行set或者进行where</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token class-name">Topic</span> topic <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">queryable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whereById</span><span class="token punctuation">(</span><span class="token string">&quot;15&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">firstOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> rows4 <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setColumns</span><span class="token punctuation">(</span>o<span class="token operator">-&gt;</span>o<span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getCreateTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">whereColumns</span><span class="token punctuation">(</span>o<span class="token operator">-&gt;</span>o<span class="token punctuation">.</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token operator">::</span><span class="token function">getStars</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> rows4<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing: <span class="token keyword">SELECT</span> t<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">,</span>t<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>stars<span class="token punctuation">\`</span></span><span class="token punctuation">,</span>t<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>title<span class="token punctuation">\`</span></span><span class="token punctuation">,</span>t<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>create_time<span class="token punctuation">\`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">\`</span>t_topic<span class="token punctuation">\`</span></span> t <span class="token keyword">WHERE</span> t<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token operator">=</span> ? <span class="token keyword">LIMIT</span> <span class="token number">1</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters: <span class="token number">15</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span>
<span class="token operator">&lt;=</span><span class="token operator">=</span> <span class="token keyword">Time</span> Elapsed: <span class="token number">3</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
<span class="token operator">&lt;=</span><span class="token operator">=</span> Total: <span class="token number">1</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing: <span class="token keyword">UPDATE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_topic<span class="token punctuation">\`</span></span> <span class="token keyword">SET</span> <span class="token identifier"><span class="token punctuation">\`</span>create_time<span class="token punctuation">\`</span></span> <span class="token operator">=</span> ? <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">\`</span>stars<span class="token punctuation">\`</span></span> <span class="token operator">=</span> ?
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters: <span class="token number">2023</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">08</span>T10:<span class="token number">48</span>:<span class="token number">05</span><span class="token punctuation">(</span>LocalDateTime<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">(</span><span class="token keyword">Integer</span><span class="token punctuation">)</span>
<span class="token operator">&lt;=</span><span class="token operator">=</span> Total: <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-策略更新" tabindex="-1"><a class="header-anchor" href="#_5-策略更新" aria-hidden="true">#</a> 5.策略更新</h2><p>只更新null列到数据库</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token class-name">Topic</span> topic <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">queryable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">whereId</span><span class="token punctuation">(</span><span class="token string">&quot;9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">firstOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> l1 <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setSQLStrategy</span><span class="token punctuation">(</span><span class="token class-name">UpdateStrategyEnum</span><span class="token punctuation">.</span><span class="token constant">ONLY_NULL_COLUMNS</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing<span class="token operator">:</span> UPDATE t_topic SET \`title\` <span class="token operator">=</span> <span class="token operator">?</span> WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> <span class="token boolean">null</span><span class="token operator">(</span><span class="token boolean">null</span><span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>只更新非null列到数据库</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token class-name">Topic</span> topic <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">queryable</span><span class="token punctuation">(</span><span class="token class-name">Topic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">whereId</span><span class="token punctuation">(</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">firstOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> l1 <span class="token operator">=</span> easyQuery<span class="token punctuation">.</span><span class="token function">updatable</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setSQLStrategy</span><span class="token punctuation">(</span><span class="token class-name">UpdateStrategyEnum</span><span class="token punctuation">.</span><span class="token constant">ONLY_NOT_NULL_COLUMNS</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Preparing<span class="token operator">:</span> UPDATE t_topic SET \`stars\` <span class="token operator">=</span> <span class="token operator">?</span><span class="token punctuation">,</span>\`create_time\` <span class="token operator">=</span> <span class="token operator">?</span> WHERE \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> <span class="token number">110</span><span class="token operator">(</span>Integer<span class="token operator">)</span><span class="token punctuation">,</span><span class="token date number">2023-03-30T</span><span class="token time number">23:12:06</span><span class="token operator">(</span>LocalDateTime<span class="token operator">)</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span> Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="map更新" tabindex="-1"><a class="header-anchor" href="#map更新" aria-hidden="true">#</a> Map更新</h2><p><code>easy-query</code>还支持<code>Map</code>结构的数据更新支持,其中<code>map</code>的<code>key</code>表示数据库对应的列名,并且不需要添加asTable来指定操作的数据库表名</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> stringObjectHashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringObjectHashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringObjectHashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringObjectHashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name1&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
easyQuery<span class="token punctuation">.</span><span class="token function">mapUpdatable</span><span class="token punctuation">(</span>stringObjectHashMap<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">asTable</span><span class="token punctuation">(</span><span class="token string">&quot;my_table&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setSQLStrategy</span><span class="token punctuation">(</span><span class="token class-name">SQLExecuteStrategyEnum</span><span class="token punctuation">.</span><span class="token constant">ALL_COLUMNS</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">whereColumns</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">executeRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token constant">UPDATE</span> \`my_table\` <span class="token constant">SET</span> \`name\` <span class="token operator">=</span> <span class="token operator">?</span><span class="token punctuation">,</span>\`name1\` <span class="token operator">=</span> <span class="token operator">?</span> <span class="token constant">WHERE</span> \`id\` <span class="token operator">=</span> <span class="token operator">?</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-注意" tabindex="-1"><a class="header-anchor" href="#_6-注意" aria-hidden="true">#</a> 6.注意</h2><p>更新优先级顺序</p><p>手动指定 &gt; 策略 &gt; 追踪 &gt; 全量更新</p>`,53),e=[o];function c(l,u){return s(),a("div",null,e)}const k=n(t,[["render",c],["__file","update.html.vue"]]);export{k as default};
